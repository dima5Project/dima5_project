<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지도 페이지</title>

    <!-- 배너 fragment -->
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <script defer th:src="@{/js/header.js}"></script>

    <!-- Mapbox CSS -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <!-- portpredict CSS -->
    <link rel="stylesheet" th:href="@{/css/portpredict.css}">

    <!-- Mapbox JS -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

    <!-- jQuery -->
    <script th:src="@{/js/jquery-3.7.1.js}"></script>

    <!-- 지도 map.js -->
    <script defer th:src="@{/js/map.js}"></script>
    <!-- 지도 위 본문 내용 js -->
    <script defer th:src="@{/js/portpredict.js}"></script>
</head>

<body>
    <div sec:authorize="isAnonymous()">
        <div th:insert="~{fragment/header :: bu3_navigation}"></div>
    </div>
    <div sec:authorize="isAuthenticated()">
        <div th:insert="~{fragment/headerJoin :: bu3_navigation_join}"></div>
    </div>

    <!-- 전체 래퍼(지도는 뒤, 사이드바는 위에 겹침) -->
    <div class="map-wrap">
        <!-- 지도 -->
        <div id="map"></div>

        <!-- 우상단 아이콘 컨트롤 -->
        <div class="map-icon-ctrl" aria-label="지도 보조 컨트롤">
            <button class="iconbtn" data-type="map" data-tip="지도 스타일">
                <img src="/images/portpredictImages/map.png" alt="" />
            </button>
            <button class="iconbtn" data-type="congestion" data-tip="혼잡도">
                <img src="/images/portpredictImages/ship_congestion.png" alt="" />
            </button>
            <button class="iconbtn" data-type="weather" data-tip="날씨">
                <img src="/images/portpredictImages/weather.png" alt="" />
            </button>
        </div>

        <!-- 왼쪽 슬라이드 사이드바 -->
        <div class="sidebar" aria-label="차항지 예측 패널">
            <!-- 핸들 -->
            <button class="sidebar__handle" type="button" aria-controls="sidebar-content" aria-expanded="true"
                title="패널 열기/닫기">
                <span class="chevron" aria-hidden="true"></span>
            </button>

            <!-- 항상 상단 고정되는 회색 박스 -->
            <div class="sidebar__topbox">
                <button class="iconwrap is-active" data-panel="predict" data-tip="차항지 예측" aria-label="차항지 예측"
                    type="button">
                    <img src="/images/portpredictImages/port.png" th:src="@{/images/portpredictImages/port.png}"
                        alt="Port Icon" class="sidebar__icon">
                </button>

                <button class="iconwrap" data-panel="log" data-tip="시점별 예측 타임라인" aria-label="시점별 예측 타임라인" type="button">
                    <img src="/images/portpredictImages/log.png" th:src="@{/images/portpredictImages/log.png}"
                        alt="Log Icon" class="sidebar__icon">
                </button>
            </div>


            <!-- 1) 예측 슬라이드 바-->
            <div class="panel panel--predict is-active">
                <!-- 상단 고정: 제목 + 폼 + hr -->
                <div class="sidebar__header">
                    <h2 class="sidebar__title">차항지 예측</h2>

                    <!-- 선박 고유 번호 select box -->
                    <div class="sidebar__section">
                        <div class="cselect" data-name="idType">
                            <button type="button" class="cselect__control" aria-haspopup="listbox"
                                aria-expanded="false">
                                <span class="cselect__value" data-value="MMSI">MMSI</span>
                                <span class="cselect__caret" aria-hidden="true"></span>
                            </button>

                            <ul class="cselect__menu" role="listbox" tabindex="-1">
                                <li class="cselect__option" role="option" data-value="MMSI" aria-selected="true">
                                    MMSI
                                </li>
                                <li class="cselect__option" role="option" data-value="IMO">IMO</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 입력 + 버튼 -->
                    <div class="sidebar__section">
                        <div class="sidebar__row">
                            <input id="imo" type="text" class="sidebar__input" placeholder="선박 고유 번호 입력" />
                            <button class="sidebar__btn primary">조회</button>
                            <button class="sidebar__btn">초기화</button>
                        </div>
                    </div>

                    <!-- 상단 고정 구역의 구분선 -->
                    <hr class="sidebar__divider" />
                </div>

                <!-- 가운데만 스크롤 되는 영역 -->
                <div id="sidebar-content" class="sidebar__content is-hidden">
                    <!-- 선박 정보 -->
                    <div class="sidebar__vesselinfo">
                        <h3 class="sidebar__sub">선박 정보</h3>
                        <img src="/images/portpredictImages/vessel.jpg" th:src="@{/images/portpredictImages/vessel.jpg}"
                            alt="vessel image" class="vessel_image" />
                        <div class="kv"><span>CALL SIGN</span><strong>S6AS6</strong></div>
                        <div class="kv"><span>SHIP TYPE</span><strong>CONTAINER</strong></div>
                        <div class="kv"><span>VSL_LENGTH</span><strong>213 m</strong></div>
                        <div class="kv"><span>VSL_WIDTH</span><strong>32 m</strong></div>
                    </div>

                    <!-- 예측 결과 -->
                    <div class="sidebar__predict">
                        <h3 class="sidebar__sub">예측 결과</h3>
                        <!-- Top 1~3 박스 -->
                        <div class="box one">
                            <div class="box__head">
                                <span class="head__label">Top - 1</span>
                                <strong>71.8%</strong>
                            </div>
                            <div class="box__body">
                                <div class="route__bg">
                                    <div class="route">
                                        <div>
                                            <b>KRBUS</b>
                                            <div class="sub">한국 / 부산</div>
                                        </div>
                                        <div class="arrow">»</div>
                                        <div>
                                            <b class="last">CNSHA</b>
                                            <div class="sub">중국 / 상하이</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="eta__time"><span class="pill">ETA</span> 2025-10-19 4:42:31</div>
                            </div>
                        </div>

                        <div class="box two">
                            <div class="box__head">
                                <span class="head__label">Top - 2</span>
                                <strong>17.8%</strong>
                            </div>
                            <div class="box__body">
                                <div class="route__bg">
                                    <div class="route">
                                        <div>
                                            <b>KRBUS</b>
                                            <div class="sub">한국 / 부산</div>
                                        </div>
                                        <div class="arrow">»</div>
                                        <div>
                                            <b class="last">HKHKG</b>
                                            <div class="sub">홍콩 / 홍콩</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="eta__time"><span class="pill">ETA</span> 2025-10-19 4:42:31</div>
                            </div>
                        </div>

                        <div class="box three">
                            <div class="box__head">
                                <span class="head__label">Top - 3</span>
                                <strong>10.4%</strong>
                            </div>
                            <div class="box__body">
                                <div class="route__bg">
                                    <div class="route">
                                        <div>
                                            <b>KRBUS</b>
                                            <div class="sub">한국 / 부산</div>
                                        </div>
                                        <div class="arrow">»</div>
                                        <div>
                                            <b class="last">TWKHH</b>
                                            <div class="sub">대만 / 가오슝</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="eta__time"><span class="pill">ETA</span> 2025-10-19 4:42:31</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 항상 하단 고정 -->
                <div class="sidebar__bottombox">
                    <button class="sidebar__btn save">결과 저장</button>
                </div>
            </div>

            <!-- 2) 로그 슬라이드 바 -->
            <div class="panel panel--log">
                <div class="sidebar__header">
                    <h2 class="sidebar__secondtitle">시점별 예측 타임라인</h2>
                </div>

                <!-- 가운데만 스크롤 되는 영역 -->
                <div class="sidebar__content logpanel">
                    <ol class="voy-timeline">
                        <!-- 출발항 -->
                        <li class="voy-item">
                            <button class="voy-node" type="button" aria-pressed="false">
                                <img th:src="@{/images/vessel_Icon.png}" alt="출발항 아이콘">
                            </button>

                            <div class="voy-rows">
                                <div class="voy-label">KRBUS 부산항</div>

                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑1</button>
                                    <div class="voy-chip">상하이 · 71.8%</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑2</button>
                                    <div class="voy-chip">홍콩 · 17.8%</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑3</button>
                                    <div class="voy-chip">가오슝 · 10.4%</div>
                                </div>
                            </div>
                        </li>

                        <!-- 05시 -->
                        <li class="voy-item">
                            <button class="voy-node" type="button" aria-pressed="false">
                                <img th:src="@{/images/marker.png}" alt="시점 마커 아이콘">
                            </button>
                            <div class="voy-rows">
                                <div class="voy-label"></div>
                                <div class="voy-label">출항 후 5시간</div>

                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑1</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑2</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑3</button>
                                    <div class="voy-chip">…</div>
                                </div>
                            </div>
                        </li>

                        <!-- 8시 -->
                        <li class="voy-item">
                            <button class="voy-node" type="button" aria-pressed="false">
                                <img th:src="@{/images/marker.png}" alt="시점 마커 아이콘">
                            </button>
                            <div class="voy-rows">
                                <div class="voy-label"></div>
                                <div class="voy-label">출항 후 8시간</div>

                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑1</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑2</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑3</button>
                                    <div class="voy-chip">…</div>
                                </div>
                            </div>
                        </li>

                        <!-- 11시(현 시점)-->
                        <li class="voy-item">
                            <button class="voy-node" type="button" aria-pressed="false"><span>14시</span></button>
                            <div class="voy-rows">
                                <div class="voy-label"></div>
                                <div class="voy-label">AIS 스냅샷</div>

                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑1</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑2</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑3</button>
                                    <div class="voy-chip">…</div>
                                </div>
                            </div>
                        </li>

                        <li class="voy-item">
                            <button class="voy-node" type="button" aria-pressed="false"><span>17시(현재)</span></button>
                            <div class="voy-rows">
                                <div class="voy-label"></div>
                                <div class="voy-label">AIS 스냅샷</div>

                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑1</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑2</button>
                                    <div class="voy-chip">…</div>
                                </div>
                                <div class="voy-row">
                                    <button class="pillbtn" type="button">Top‑3</button>
                                    <div class="voy-chip">…</div>
                                </div>
                            </div>
                        </li>

                    </ol>
                </div>
            </div>
            <!-- 로그 슬라이드 바 끝-->

        </div>
    </div>
    <!-- 저장 확인 모달 -->
    <div id="saveModal" class="modal" aria-hidden="true">
        <div class="modal__bg" data-action="close"></div>
        <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="saveModalTitle">
            <h3 id="saveModalTitle" class="modal__title">결과를 저장할까요?</h3>
            <div class="modal__actions">
                <button class="modal__btn primary" data-action="yes">예</button>
                <button class="modal__btn secondary" data-action="no">아니오</button>
            </div>
        </div>
    </div>
</body>

</html>