<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">


<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Q&A 문의</title>

    <!-- 폰트/공통 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
    <script defer th:src="@{/js/header.js}"></script>

    <!-- 페이지 전용 -->
    <link rel="stylesheet" href="/css/askList.css" th:href="@{/css/askList.css}">
    <script defer src="/js/askList.js?v=1"></script>

    <link rel="stylesheet" th:href="@{/css/footer.css}">
</head>

<body>
    <div sec:authorize="isAnonymous()">
        <div th:replace="~{fragment/header :: bu3_navigation}"></div>
    </div>
    <div sec:authorize="isAuthenticated()">
        <div th:replace="~{fragment/headerJoin :: bu3_navigation_join}"></div>
    </div>

    <div class="qna-header-bg">
        <section class="qna-header">
            <h2>Q & A</h2>
            <p>궁금하신 내용을 남겨주시면 빠르게 답변 드리겠습니다.</p>
        </section>
    </div>

    <main>
        <!-- 카테고리(클라이언트 필터) -->
        <section class="qna-category">
            <button class="filter-btn active">전체</button>
            <button class="filter-btn">회원가입</button>
            <button class="filter-btn">서비스 이용</button>
            <button class="filter-btn">기타</button>
        </section>

        <!-- 검색 -->
        <section class="qna-search">
            <span>전체 <strong th:text="${list.totalElements}">0</strong>건</span>

            <form th:action="@{/ask}" method="get" class="qna-search-right">
                <select name="searchItem">
                    <option value="" th:selected="${searchItem == null or searchItem == ''}">선택</option>
                    <option value="all" th:selected="${searchItem == 'all'}">전체(글쓴이+제목)</option>
                    <option value="writer" th:selected="${searchItem == 'writer'}">글쓴이</option>
                    <option value="askTitle" th:selected="${searchItem == 'askTitle'}">제목</option>
                </select>

                <input type="text" name="searchWord" th:value="${searchWord}" placeholder="검색어를 입력하세요" />
                <button type="submit" class="search-btn">검색</button>
            </form>
        </section>

        <!-- 목록 -->
        <section class="qna-table">
            <table>
                <thead>
                    <tr>
                        <th>일련번호</th>
                        <th>문의 유형</th>
                        <th>제목</th>
                        <th>글쓴이</th>
                        <th>등록일</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 0건 처리 -->
                    <tr th:if="${#lists.isEmpty(list.content)}">
                        <td colspan="5">등록된 글이 없습니다.</td>
                    </tr>

                    <!-- DB 데이터 렌더 -->
                    <th:block th:each="q : ${list.content}">
                        <!-- 목록 행 -->
                        <tr class="qna-row" th:attr="data-id=${q.askSeq},data-category=${#strings.trim(q.askType)}">
                            <td th:text="${q.askSeq}">1</td>
                            <td th:text="${q.askType}">서비스 이용</td>
                            <td class="toggle-password">
                                <span th:text="${q.askTitle}">제목</span>
                                <span class="secret"
                                    th:if="${q.askPwd != null and !#strings.isEmpty(q.askPwd)}">[비밀글]</span>
                                <span class="answered" th:if="${q.replyStatus == true}">[답변 완료]</span>
                            </td>
                            <td th:text="${q.writer != null ? q.writer.userId : '익명'}">writer</td>
                            <td th:text="${q.createDate != null ? #temporals.format(q.createDate, 'yyyy-MM-dd') : '-'}">
                                -</td>
                        </tr>

                        <!-- 비번 입력 행 -->
                        <tr class="password-row hidden" th:attr="data-id=${q.askSeq}">
                            <td colspan="5">
                                <div class="password-box" th:if="${q.askPwd != null and !#strings.isEmpty(q.askPwd)}">
                                    <label>비밀번호 입력: </label>
                                    <input type="password" />
                                    <button class="check-btn">확인</button>
                                </div>
                                <div class="password-box" th:if="${q.askPwd == null or #strings.isEmpty(q.askPwd)}">
                                    <em>공개글입니다. 클릭하면 내용이 열립니다.</em>
                                    <button class="check-btn">열기</button>
                                </div>
                            </td>
                        </tr>

                        <!-- 상세 내용 -->
                        <tr class="detail-row hidden" th:attr="data-id=${q.askSeq}">
                            <td colspan="5">
                                <div class="detail-box" th:text="${q.askContent}">내용</div>
                                <!-- 첨부파일 표시 -->
                                <div class="attach" th:if="${q.savedFilename != null}" style="margin-top:8px;">
                                    <strong>첨부파일: </strong>
                                    <a th:href="@{/ask/download(askSeq=${q.askSeq})}"
                                        th:text="${q.originalFilename != null ? q.originalFilename : '다운로드'}">
                                        다운로드
                                    </a>
                                </div>
                                <div class="detail-actions" style="margin-top:10px; text-align:right;">
                                    <button type="button" class="btn-delete" th:attr="data-id=${q.askSeq}">
                                        삭제
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <!-- 답변 -->
                        <tr class="answer-row hidden" th:if="${q.replyStatus == true}" th:attr="data-id=${q.askSeq}">
                            <td colspan="5">
                                <div class="answer-box">
                                    <strong>↳ 답변</strong>
                                    <p th:text="${q.reply != null ? q.reply.replyContent : '답변 준비 중'}">답변</p>
                                </div>
                            </td>
                        </tr>
                    </th:block>
                </tbody>
            </table>
        </section>

        <!-- 페이지네이션 (Page 객체 기반) -->
        <section class="pagination" th:if="${list.totalPages > 0}">
            <!-- 이전 -->
            <a class="page-btn" th:classappend="${list.first} ? ' disabled' : ''"
                th:href="@{/ask(page=${list.number - 1}, searchItem=${searchItem}, searchWord=${searchWord})}"
                th:if="${!list.first}">&lt;</a>
            <button class="page-btn disabled" th:if="${list.first}">&lt;</button>

            <!-- 페이지 번호 1..totalPages -->
            <th:block th:each="i : ${#numbers.sequence(1, list.totalPages)}">
                <a class="page-btn" th:text="${i}" th:classappend="${list.number == i - 1} ? ' active' : ''"
                    th:href="@{/ask(page=${i - 1}, searchItem=${searchItem}, searchWord=${searchWord})}">1</a>
            </th:block>

            <!-- 다음 -->
            <a class="page-btn" th:classappend="${list.last} ? ' disabled' : ''"
                th:href="@{/ask(page=${list.number + 1}, searchItem=${searchItem}, searchWord=${searchWord})}"
                th:if="${!list.last}">&gt;</a>
            <button class="page-btn disabled" th:if="${list.last}">&gt;</button>
        </section>

        <!-- 글쓰기 -->
        <div class="write-btn-wrap">
            <a class="write-btn" th:href="@{/ask/write}">글쓰기</a>
        </div>
    </main>

    <div th:replace="~{/fragment/footer::footer(title='부3갈매기')}"></div>
</body>

</html>